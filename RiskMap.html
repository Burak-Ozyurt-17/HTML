<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Risk Heatmap Widget</title>
  <script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-core.min.js"></script>
  <script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-heatmap.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
    }
    #container {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <script>
    anychart.onDocumentReady(function () {
      const rows = 15;
      const cols = 15;

      const latStart = 40.90;
      const lonStart = 29.00;
      const latEnd = 40.70;
      const lonEnd = 29.30;

      const riskCenters = [
        [40.82, 29.05],
        [40.78, 29.18],
        [40.75, 29.10]
      ];

      const latStep = (latEnd - latStart) / (rows - 1);
      const lonStep = (lonEnd - lonStart) / (cols - 1);

      function distance(lat1, lon1, lat2, lon2) {
        return Math.sqrt(Math.pow(lat1 - lat2, 2) + Math.pow(lon1 - lon2, 2));
      }

      function generateRiskData() {
        let data = [];
        const maxDist = Math.sqrt(Math.pow(latStart - latEnd, 2) + Math.pow(lonStart - lonEnd, 2));
        for (let i = 0; i < rows; i++) {
          for (let j = 0; j < cols; j++) {
            const lat = latStart + i * latStep;
            const lon = lonStart + j * lonStep;

            let minDist = Infinity;
            for (const center of riskCenters) {
              const d = distance(lat, lon, center[0], center[1]);
              if (d < minDist) minDist = d;
            }

            let riskValue = 1 - minDist / maxDist;
            riskValue += (Math.random() - 0.5) * 0.1;
            riskValue = Math.min(Math.max(riskValue, 0), 1);

            data.push({
              x: j.toString(),  // Sadece indeks veriliyor
              y: i.toString(),  // Sadece indeks veriliyor
              heat: riskValue * 100
            });
          }
        }
        return data;
      }

      let chart = anychart.heatMap(generateRiskData());
      chart.labels(false);
      chart.stroke("none");

      let scale = anychart.scales.linearColor();
      scale.colors(["#00ff00", "#ffff00", "#ff0000"]);
      chart.colorScale(scale);

      chart.xAxis(false);
      chart.yAxis(false);

      chart.container("container");
      chart.draw();

      setInterval(() => {
        chart.data(generateRiskData());
      }, 3000);
    });
  </script>
</body>
</html>
